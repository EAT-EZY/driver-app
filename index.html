<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EAT-EZY Driver Portal</title>
    
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">

    <style>
        :root {
            --ee-black: #000000;
            --ee-yellow: #FFD700;
            --ee-red: #FF3B30;
            --ee-gray: #1C1C1E;
            --text-white: #FFFFFF;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--ee-black);
            color: var(--text-white);
            margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { width: 100%; max-width: 450px; padding-bottom: 50px; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--ee-yellow); padding-bottom: 10px; }
        header h1 { color: var(--ee-yellow); margin: 0; letter-spacing: 2px; text-transform: uppercase; }

        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .card { background: var(--ee-gray); padding: 15px; border-radius: 12px; text-align: center; border-bottom: 3px solid var(--ee-yellow); }
        .card small { color: #888; text-transform: uppercase; font-size: 0.7rem; display: block; }
        .card div { font-size: 1.6rem; font-weight: bold; margin-top: 5px; color: var(--ee-yellow); }

        .input-group { background: var(--ee-gray); padding: 20px; border-radius: 15px; margin-bottom: 20px; box-sizing: border-box; }
        label { display: block; margin-bottom: 5px; color: var(--ee-yellow); font-weight: bold; font-size: 0.9rem; }
        input { 
            width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; 
            border: 1px solid #444; background: #000; color: white; font-size: 1.1rem; box-sizing: border-box; 
        }
        
        button { width: 100%; padding: 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-add { background-color: var(--ee-yellow); color: black; margin-bottom: 10px; font-size: 1rem; }
        .btn-end { background-color: var(--ee-red); color: white; font-size: 0.9rem; }

        .goal-container { background: #111; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #333; }
        .progress-bg { background: #333; height: 12px; border-radius: 6px; overflow: hidden; margin: 10px 0; }
        #goalProgress { background: var(--ee-yellow); width: 0%; height: 100%; transition: width 0.5s ease; }
        #goalText { font-size: 0.8rem; text-align: center; color: #aaa; }

        table { width: 100%; border-collapse: collapse; background: var(--ee-gray); border-radius: 10px; overflow: hidden; margin-top: 10px; }
        th { background: #222; color: var(--ee-yellow); padding: 12px; text-align: left; font-size: 0.75rem; }
        td { padding: 12px; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .total-row { font-weight: bold; background: #000; color: var(--ee-yellow); }

        .faq { margin-top: 30px; padding: 15px; background: #0a0a0a; border-radius: 10px; font-size: 0.85rem; color: #ccc; border: 1px dashed #333; }
        .faq h4 { color: var(--ee-yellow); margin-top: 0; }
        
        .footer-btns { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>EAT-EZY</h1>
        <p>DRIVER REVENUE PORTAL</p>
    </header>

    <div class="dashboard">
        <div class="card"><small>Shift Jobs</small><div id="jobCount">0</div></div>
        <div class="card"><small>Shift Pay</small><div id="totalPayout">$0.00</div></div>
    </div>

    <div class="input-group">
        <label>Delivery Fee ($)</label>
        <input type="number" id="delFee" placeholder="0.00" inputmode="decimal">
        <label>Tip ($)</label>
        <input type="number" id="tipAmount" placeholder="0.00" inputmode="decimal">
        <button class="btn-add" onclick="addJob()">ADD JOB</button>
        <button class="btn-end" onclick="endShift()">END SHIFT & LOG</button>
    </div>

    <div class="goal-container">
        <label>Weekly Target ($)</label>
        <input type="number" id="weeklyGoal" placeholder="Enter goal" onchange="updateGoal(this.value)">
        <div class="progress-bg"><div id="goalProgress"></div></div>
        <div id="goalText">0% reached</div>
    </div>

    <table>
        <thead><tr><th>Day</th><th>Jobs</th><th>Earnings</th></tr></thead>
        <tbody id="weeklyBody"></tbody>
        <tr class="total-row"><td>TOTAL</td><td id="weekJobs">0</td><td id="weekPay">$0.00</td></tr>
    </table>

    <div class="footer-btns">
        <button class="btn-add" onclick="exportData()">EXPORT REPORT</button>
        <button class="btn-end" onclick="resetHistory()">RESET</button>
    </div>

    <div class="faq">
        <h4>Earnings Info</h4>
        <p><strong>Formula:</strong> (Fee - 10% GST) x 75% + 100% Tips.</p>
        <p><strong>Storage:</strong> Data is saved to your phone. Management only sees what you export.</p>
    </div>
</div>

<script>
    let currentShift = { jobs: 0, earnings: 0 };
    let history = JSON.parse(localStorage.getItem('ee_history')) || [];
    let myGoal = localStorage.getItem('ee_goal') || 0;

    document.getElementById('weeklyGoal').value = myGoal;
    updateUI();

    function updateUI() {
        document.getElementById('jobCount').innerText = currentShift.jobs;
        document.getElementById('totalPayout').innerText = `$${currentShift.earnings.toFixed(2)}`;
        
        const tbody = document.getElementById('weeklyBody');
        tbody.innerHTML = '';
        let wJobs = 0, wPay = 0;

        history.slice().reverse().forEach(shift => {
            tbody.innerHTML += `<tr><td>${shift.date}</td><td>${shift.jobs}</td><td>$${shift.pay.toFixed(2)}</td></tr>`;
            wJobs += shift.jobs; wPay += shift.pay;
        });

        document.getElementById('weekJobs').innerText = wJobs;
        document.getElementById('weekPay').innerText = `$${wPay.toFixed(2)}`;

        const percent = myGoal > 0 ? Math.min((wPay / myGoal) * 100, 100) : 0;
        const bar = document.getElementById('goalProgress');
        bar.style.width = percent + "%";
        bar.style.backgroundColor = percent < 40 ? "var(--ee-red)" : "var(--ee-yellow)";
        document.getElementById('goalText').innerText = `${Math.round((wPay / (myGoal || 1)) * 100)}% of goal reached`;
    }

    function addJob() {
        const fee = parseFloat(document.getElementById('delFee').value) || 0;
        const tip = parseFloat(document.getElementById('tipAmount').value) || 0;
        if (fee <= 0) return;

        const net = (fee / 1.1) * 0.75 + tip;
        currentShift.jobs++;
        currentShift.earnings += net;

        document.getElementById('delFee').value = '';
        document.getElementById('tipAmount').value = '';
        updateUI();
    }

    function endShift() {
        if (currentShift.jobs === 0) return;
        if (confirm("Move current shift to history?")) {
            history.push({
                date: new Date().toLocaleDateString('en-AU', { weekday: 'short', day: 'numeric' }),
                jobs: currentShift.jobs,
                pay: currentShift.earnings
            });
            if (history.length > 7) history.shift();
            localStorage.setItem('ee_history', JSON.stringify(history));
            currentShift = { jobs: 0, earnings: 0 };
            updateUI();
        }
    }

    function updateGoal(val) {
        myGoal = parseFloat(val) || 0;
        localStorage.setItem('ee_goal', myGoal);
        updateUI();
    }

    function resetHistory() {
        if (confirm("Clear all data?")) {
            history = [];
            localStorage.removeItem('ee_history');
            updateUI();
        }
    }

    function exportData() {
        let total = 0;
        let report = "EAT-EZY DRIVER REPORT\n";
        history.forEach(s => {
            report += `${s.date}: ${s.jobs} jobs | $${s.pay.toFixed(2)}\n`;
            total += s.pay;
        });
        report += `TOTAL: $${total.toFixed(2)}`;
        window.location.href = "mailto:?subject=Earnings Report&body=" + encodeURIComponent(report);
    }
</script>
</body>
</html>